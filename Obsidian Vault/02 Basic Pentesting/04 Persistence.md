So we've set up a reverse shell, upgraded it, privilege escalated it, and upgraded it once more. It was all kind of... tedious wasn't it? So we don't want to do that every time we are trying to hack a box. Once you're in your victim's machine, there's a relatively simple way for you to get back in anytime you want. And that process is called setting up persistence. And here you do the reverse shell process in reverse, pick your payload, set up a port forwarding rule then set up your listener.

1. ## Pick You Reverse Shell payload.
First step is to head over to revshell.com and pick (and validate) a shell that is going to work for your root shell that we previously made, pick a port number that you will use for the shell as well. Refer to #Revshell if you need a refresher on revshells.com

![[Pasted image 20231210204721.png]]
(You don’t have to use Python necessarily, for instance, perl works well, too, sometimes it's trial and error.)

Throw it into your “root,” but don’t hit enter yet, screen back to your main session:

Next you'll need to make a new #port-forwarding rule to allow the payload to reach your listener. Pick a port number that you can easily organize and remember

Finally we use the #Basic-listener command nc -lvp PORT# and make the connection: 
![[Pasted image 20231210205742.png]]
And there is your root command on your attacker machine terminal.

2. ## Crontabs

This is the persistence shell you will use. Now all we need is a way for the victim machine to automatically send a payload to our listener when we turn it on. It's not terribly complicated but let's go over crontabs. Because this is what is going to be our automation tool to get us persistence. 

- A **cron job** is a task or command you want to run automatically at specified intervals. These tasks could be running a script, updating a database, sending emails, or performing system maintenance.
- A **cron table** is like a schedule or a time-management tool for Unix-like operating systems, It is a file that contains a list of commands meant to be run at specified times. This file is often referred to as the "crontab" file.

So to get into our #crontab we, on our listener, use the command sudo crontab -e and this will get us into the tables, here you can edit your cronjobs and , the cron daemon will automatically pick up the changes, and the scheduled tasks will be executed according to the specified schedule

In the real world you're not going to make your cronjob so easy to spot but for lab environments having it organized should help you. use a format like below and then insert your #Revshell code beneath and you should be in business. 
![[Pasted image 20231210211725.png]]

And that’s it. You’ve made persistence. Think about what you’ve done. You set up a listener, and a port forwarding rule and then set a payload that is going to be executed “persistently” that allows that payload to go out to your machine anytime you set up that same listener.

After this is all done. When you come back use you nc -lvp #### command and it should catch within a minute, after this, don’t forget to upgrade the shell.
![[Pasted image 20231210211919.png]]
